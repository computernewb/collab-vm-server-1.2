function debugLog(e){DEBUG_LOG&&console.log(e)}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}function forEachInput(e,t){e.find("input").filter(function(){return this.name&&!$(this).is(":disabled")&&(void 0!=this.value||this.checked)}).each(function(){var e=null;e=$(this).is(":checkbox")?this.checked:"number"===$(this).attr("type")?this.value:'"'+this.value+'"',t(this.name,e)}),e.find("button.dropdown-toggle").filter(function(){return this.name&&!$(this).is(":disabled")&&$(this).data("value")}).each(function(){t(this.name,'"'+$(this).data("value")+'"')})}function saveServerSettings(){displayLoading();var e="";forEachInput($("#server-settings"),function(t,n){e+='"'+t+'":'+n+","}),e&&(e='{"settings":{'+e.substring(0,e.length-1)+"}}",debugLog(e),tunnel.sendMessage("admin",4,e))}function saveVMSettings(){displayLoading();var e="";forEachInput($("#vm-settings"),function(t,n){t.match("^vm-")&&(e+='"'+t.substr(3)+'":'+n+",")}),e&&(e=vmSettingsName?'{"update-vm":{'+e.substring(0,e.length-1)+"}}":'{"add-vm":{'+e.substring(0,e.length-1)+"}}",debugLog(e),vmSettingsName=null,$("#vm-settings").hide(),$("#vm-list").parent().addClass("table-hover"),$("#new-vm-btn").prop("disabled",!0),tunnel.sendMessage("admin",4,e))}function splitQueryString(e){for(var t=e.split("&"),n={},a=0;a<t.length;a++){var o=t[a].split("="),r=decodeURIComponent(o[0]),i=o[1]||"";n[r]=decodeURIComponent(i.replace(/\+/g," "))}return n}function setInputValue(e,t,n){var a=e.find("input[name='"+t+"']").eq(0);if(a.length)return a.is(":checkbox")?(a.prop("checked","1"==n),a.trigger("change")):a.val(n),!0;if((a=e.find("button.dropdown-toggle[name='"+t+"']").eq(0)).length){var o=a.parent().find("ul.dropdown-menu li a[data-value='"+n+"']").eq(0);if(o.length)return a.html(o.text()+' <span class="caret"></span>'),a.data("value",n),a.trigger("dropdown"),!0}return!1}function displaySettingsError(e,t,n){var a;a=n?createAlert("<strong>Successfully changed settings</strong>",!1,"success"):createAlert("<strong>Settings Error</strong><br>"+(t?"<em>"+e+"</em>: "+t:e)),$("#alert-box").parent().parent().prepend(a),a.show("fast")}function parseSettings(e){var t=jQuery.parseJSON(e);if(t.result&&(t.result!==!0?(debugLog("Error changing settings"),debugLog(t.result),"object"==typeof t.result?$.each(t.result,displaySettingsError):displaySettingsError(t.result)):(debugLog("Successfully changed settings"),displaySettingsError(null,null,!0))),t.settings){var n=$("#server-settings"),a=$("#vm-list");a.html(""),vmTableSelected=null,$.each(t.settings,function(e,t){"vm"==e&&$.isArray(t)?$.each(t,function(e,t){if(t.hasOwnProperty("name")){vmList[t.name]=t;var n=document.createElement("tr"),o=document.createElement("td");o=document.createElement("td"),o.innerHTML=t.name,n.appendChild(o),o=document.createElement("td"),o.innerHTML=statusMessages[t.status],n.appendChild(o),$(n).click(function(){$("#vm-settings").is(":visible")||(vmTableSelected=$(this).addClass("info").find("td").eq(0).text(),updateVMButtons(vmList[vmTableSelected]))}),a.append(n)}}):setInputValue(n,e,t)})}$("#server-settings").is(":visible")||displayServerSettings()}function updateVMButtons(e){var t=$("#vm-settings").is(":visible");$("#start-vm-btn").prop("disabled",t||!e||e.status!=vmStatus.STOPPED),$("#stop-vm-btn").prop("disabled",t||!e||e.status!=vmStatus.RUNNING),$("#restart-vm-btn").prop("disabled",t||!e||e.status!=vmStatus.RUNNING),$("#vm-action-btn").prop("disabled",t||!e||e.status!=vmStatus.RUNNING),$("#settings-vm-btn").prop("disabled",t||!e)}function getConfig(){displayLoading(),tunnel.sendMessage("admin",3)}function restoreVM(e){tunnel.sendMessage("admin",9,e)}function displayLoading(){$("#vm-settings").hide(),$("#server-settings").hide(),$("#password-input").hide(),$("#loading").show()}function displayPasswordInput(){$("#vm-settings").hide(),$("#server-settings").hide(),$("#loading").hide(),$("#invalid-pwd").hide(),$("#master-pwd").val("").prop("disabled",!1),$("#pwd-submit").prop("disabled",!1),$("#password-input").show("slow")}function displayServerSettings(){$("#password-input").hide(),vmSettingsName?($("#vm-settings").show(),updateVMButtons(vmList[vmSettingsName])):$("#vm-settings").hide(),$("#loading").hide(),$("#server-settings").show("slow")}function showVMSettings(e){var t,n;if(e){if(t=vmList[e],!t)return;n="<em>"+t.name+"</em> Settings",$("#delete-vm-btn").show(),$("#qemu-monitor").show()}else t=defaultVMSettings,n="New VM Settings",$("#delete-vm-btn").hide(),$("#qemu-monitor").hide();$("#vm-panel-heading").html(n);var a=$("#vm-settings");$.each(t,function(e,t){setInputValue(a,"vm-"+e,t)}),$("#restore-hours-box").val(0),$("#restore-minutes-box").val(0),vmSettingsName=e,hideVMSettings(!0)}function hideVMSettings(e){e=!!e,$("#new-vm-btn").prop("disabled",e),e?($("#vm-list").parent().removeClass("table-hover"),$("#vm-settings").show("slow")):($("#vm-list").parent().addClass("table-hover"),$("#vm-settings").hide("fast"),vmSettingsName=null),vmSettingsVisible=e}function createAlert(e,t,n){return $('<div class="alert alert-'+(n||"danger")+' alert-dismissible" role="alert"'+(t?"":' style="display: none;"')+'><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div>")}function submitPassword(){$("#invalid-pwd").hide();var e=$("#master-pwd");e.prop("disabled",!0),$("#pwd-submit").prop("disabled",!0),tunnel.sendMessage("admin",2,e.val())}function changePassword(){tunnel.sendMessage("admin",4,'{"password":"'+$("#chng-pwd-box").val()+'"}')}function connect(){if(tunnel.state==Guacamole.Tunnel.State.CONNECTING||tunnel.state==Guacamole.Tunnel.State.CLOSED)try{displayLoading(),tunnel.connect()}catch(e){reconnect()}else tunnel.disconnect()}function reconnect(){setTimeout(function(){tunnel.state=Guacamole.Tunnel.State.CONNECTING,connect()},5e3)}function sendQEMUCmd(){if(tunnel.state==Guacamole.Tunnel.State.OPEN&&null!=vmSettingsName){var e=$("#qemu-monitor-input"),t=e.val().trim();tunnel.sendMessage("admin",5,vmSettingsName,t),qemuMonitorOutput("&#13;&#10;> "+t),e.val("")}}function qemuMonitorOutput(e){var t=$("#qemu-monitor-output");t.html(t.html()+e+"&#13;&#10;"),t.scrollTop(t[0].scrollHeight)}var Guacamole=Guacamole||{};Guacamole.ArrayBufferReader=function(e){var t=this;e.onblob=function(e){for(var n=window.atob(e),a=new ArrayBuffer(n.length),o=new Uint8Array(a),r=0;r<n.length;r++)o[r]=n.charCodeAt(r);t.ondata&&t.ondata(a)},e.onend=function(){t.onend&&t.onend()},this.ondata=null,this.onend=null};var Guacamole=Guacamole||{};Guacamole.ArrayBufferWriter=function(e){function t(t){for(var n="",a=0;a<t.byteLength;a++)n+=String.fromCharCode(t[a]);e.sendBlob(window.btoa(n))}var n=this;e.onack=function(e){n.onack&&n.onack(e)},this.sendData=function(e){var n=new Uint8Array(e);if(n.length<=8064)t(n);else for(var a=0;a<n.length;a+=8064)t(n.subarray(a,a+8094))},this.sendEnd=function(){e.sendEnd()},this.onack=null};var Guacamole=Guacamole||{};Guacamole.AudioChannel=function(){var e=0;this.play=function(t,n,a){var o=new Guacamole.AudioChannel.Packet(t,a),r=Guacamole.AudioChannel.getTimestamp();r>e&&(e=r),o.play(e),e+=n}},window.AudioContext?Guacamole.AudioChannel.context=new AudioContext:window.webkitAudioContext&&(Guacamole.AudioChannel.context=new webkitAudioContext),Guacamole.AudioChannel.getTimestamp=function(){if(Guacamole.AudioChannel.context)return 1e3*Guacamole.AudioChannel.context.currentTime;if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return(new Date).getTime()},Guacamole.AudioChannel.Packet=function(e,t){function n(e){s.buffer=e,s.start(u/1e3)}function a(){c.src?c.play():l=!0}if(this.play=function(e){},Guacamole.AudioChannel.context){var o=null,r=function(e){o=e},i=new FileReader;i.onload=function(){Guacamole.AudioChannel.context.decodeAudioData(i.result,function(e){r(e)})},i.readAsArrayBuffer(t);var s=Guacamole.AudioChannel.context.createBufferSource();s.connect(Guacamole.AudioChannel.context.destination),s.start||(s.start=s.noteOn);var u;this.play=function(e){u=e,o?n(o):r=n}}else{var l=!1,c=null;try{c=new Audio}catch(d){}if(c){var i=new FileReader;i.onload=function(){for(var t="",n=new Uint8Array(i.result),a=0;a<n.byteLength;a++)t+=String.fromCharCode(n[a]);c.src="data:"+e+";base64,"+window.btoa(t),l&&c.play()},i.readAsArrayBuffer(t),this.play=function(e){var t=Guacamole.AudioChannel.getTimestamp(),n=e-t;0>n?a():window.setTimeout(a,n)}}}};var Guacamole=Guacamole||{};Guacamole.BlobReader=function(e,t){var n,a=this,o=0;n=window.BlobBuilder?new BlobBuilder:window.WebKitBlobBuilder?new WebKitBlobBuilder:window.MozBlobBuilder?new MozBlobBuilder:new function(){var e=[];this.append=function(n){e.push(new Blob([n],{type:t}))},this.getBlob=function(){return new Blob(e,{type:t})}},e.onblob=function(t){for(var r=window.atob(t),i=new ArrayBuffer(r.length),s=new Uint8Array(i),u=0;u<r.length;u++)s[u]=r.charCodeAt(u);n.append(i),o+=i.byteLength,a.onprogress&&a.onprogress(i.byteLength),e.sendAck("OK",0)},e.onend=function(){a.onend&&a.onend()},this.getLength=function(){return o},this.getBlob=function(){return n.getBlob()},this.onprogress=null,this.onend=null};var Guacamole=Guacamole||{};Guacamole.Client=function(e){function t(e){e!=f&&(f=e,i.onstatechange&&i.onstatechange(f))}function n(){return f==c||f==l}function a(e){var t=w[e];return t||(t=0===e?g.getDefaultLayer():e>0?g.createLayer():g.createBuffer(),w[e]=t),t}function o(t){var n=y[t];return null==n&&(n=y[t]=new Guacamole.Parser,n.oninstruction=e.oninstruction),n}function r(e){var t=b[e];return null==t&&(t=b[e]=new Guacamole.AudioChannel),t}var i=this,s=0,u=1,l=2,c=3,d=4,h=5,f=s,m=null,p={0:"butt",1:"round",2:"square"},v={0:"bevel",1:"miter",2:"round"},g=new Guacamole.Display,w={},y=[],b=[],S=[],k=new Guacamole.IntegerPool,I=[];this.getDisplay=function(){return g},this.sendSize=function(t,a){n()&&e.sendMessage("size",t,a)},this.sendKeyEvent=function(t,a){n()&&e.sendMessage("key",a,t)},this.sendMouseState=function(t){if(n()){g.moveCursor(Math.floor(t.x),Math.floor(t.y));var a=0;t.left&&(a|=1),t.middle&&(a|=2),t.right&&(a|=4),t.up&&(a|=8),t.down&&(a|=16),e.sendMessage("mouse",Math.floor(t.x),Math.floor(t.y),a)}},this.setClipboard=function(e){if(n()){for(var t=i.createClipboardStream("text/plain"),a=new Guacamole.StringWriter(t),o=0;o<e.length;o+=4096)a.sendText(e.substring(o,o+4096));a.sendEnd()}},this.createFileStream=function(t,n){var a=k.next();e.sendMessage("file",a,t,n);var o=I[a]=new Guacamole.OutputStream(i,a),r=o.sendEnd;return o.sendEnd=function(){r(),k.free(a),delete I[a]},o},this.createPipeStream=function(t,n){var a=k.next();e.sendMessage("pipe",a,t,n);var o=I[a]=new Guacamole.OutputStream(i,a),r=o.sendEnd;return o.sendEnd=function(){r(),k.free(a),delete I[a]},o},this.createClipboardStream=function(t){var n=k.next();e.sendMessage("clipboard",n,t);var a=I[n]=new Guacamole.OutputStream(i,n),o=a.sendEnd;return a.sendEnd=function(){o(),k.free(n),delete I[n]},a},this.sendAck=function(t,a,o){n()&&e.sendMessage("ack",t,a,o)},this.sendBlob=function(t,a){n()&&e.sendMessage("blob",t,a)},this.endStream=function(t){n()&&e.sendMessage("end",t)},this.onstatechange=null,this.onname=null,this.onerror=null,this.onclipboard=null,this.onfile=null,this.onpipe=null,this.onsync=null,this.onturn=null,this.onchat=null,this.onrename=null,this.onadduser=null,this.onremuser=null,this.onconnect=null,this.onlist=null,this.onvote=null,this.onaction=null;var G={"miter-limit":function(e,t){g.setMiterLimit(e,parseFloat(t))}},T={turn:function(e){i.onturn&&i.onturn(e)},rename:function(e){i.onrename&&i.onrename(e)},chat:function(e){i.onchat&&i.onchat(e)},adduser:function(e){i.onadduser&&i.onadduser(e)},remuser:function(e){i.onremuser&&i.onremuser(e)},connect:function(e){i.onconnect&&i.onconnect(e)},list:function(e){i.onlist&&i.onlist(e)},vote:function(e){i.onvote&&i.onvote(e)},action:function(e){i.onaction&&i.onaction(e)},file:function(e){i.onfile&&i.onfile(e)},nop:function(){e.sendMessage("nop")},ack:function(e){var t=parseInt(e[0]),n=e[1],a=parseInt(e[2]),o=I[t];o&&(o.onack&&o.onack(new Guacamole.Status(a,n)),a>=256&&(k.free(t),delete I[t]))},arc:function(e){var t=a(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),i=parseFloat(e[4]),s=parseFloat(e[5]),u=parseInt(e[6]);g.arc(t,n,o,r,i,s,0!=u)},audio:function(e){var t=parseInt(e[0]),n=r(parseInt(e[1])),a=e[2],o=parseFloat(e[3]),s=S[t]=new Guacamole.InputStream(i,t),u=new Guacamole.BlobReader(s,a);u.onend=function(){n.play(a,o,u.getBlob())},i.sendAck(t,"OK",0)},blob:function(e){var t=parseInt(e[0]),n=e[1],a=S[t];a.onblob(n)},cfill:function(e){var t=parseInt(e[0]),n=a(parseInt(e[1])),o=parseInt(e[2]),r=parseInt(e[3]),i=parseInt(e[4]),s=parseInt(e[5]);g.setChannelMask(n,t),g.fillColor(n,o,r,i,s)},clip:function(e){var t=a(parseInt(e[0]));g.clip(t)},clipboard:function(e){var t=parseInt(e[0]),n=e[1];if(i.onclipboard){var a=S[t]=new Guacamole.InputStream(i,t);i.onclipboard(a,n)}else i.sendAck(t,"Clipboard unsupported",256)},close:function(e){var t=a(parseInt(e[0]));g.close(t)},copy:function(e){var t=a(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),i=parseInt(e[4]),s=parseInt(e[5]),u=a(parseInt(e[6])),l=parseInt(e[7]),c=parseInt(e[8]);g.setChannelMask(u,s),g.copy(t,n,o,r,i,u,l,c)},cstroke:function(e){var t=parseInt(e[0]),n=a(parseInt(e[1])),o=p[parseInt(e[2])],r=v[parseInt(e[3])],i=parseInt(e[4]),s=parseInt(e[5]),u=parseInt(e[6]),l=parseInt(e[7]),c=parseInt(e[8]);g.setChannelMask(n,t),g.strokeColor(n,o,r,i,s,u,l,c)},cursor:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),o=a(parseInt(e[2])),r=parseInt(e[3]),i=parseInt(e[4]),s=parseInt(e[5]),u=parseInt(e[6]);g.setCursor(t,n,o,r,i,s,u)},curve:function(e){var t=a(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),i=parseInt(e[4]),s=parseInt(e[5]),u=parseInt(e[6]);g.curveTo(t,n,o,r,i,s,u)},dispose:function(e){var t=parseInt(e[0]);if(t>0){var n=a(t);n.dispose(),delete w[t]}else 0>t&&delete w[t]},distort:function(e){var t=parseInt(e[0]),n=parseFloat(e[1]),o=parseFloat(e[2]),r=parseFloat(e[3]),i=parseFloat(e[4]),s=parseFloat(e[5]),u=parseFloat(e[6]);if(t>=0){var l=a(t);l.distort(n,o,r,i,s,u)}},error:function(e){var t=e[0],n=parseInt(e[1]);i.onerror&&i.onerror(new Guacamole.Status(n,t)),i.disconnect()},end:function(e){var t=parseInt(e[0]),n=S[t];n.onend&&n.onend()},identity:function(e){var t=a(parseInt(e[0]));g.setTransform(t,1,0,0,1,0,0)},lfill:function(e){var t=parseInt(e[0]),n=a(parseInt(e[1])),o=a(parseInt(e[2]));g.setChannelMask(n,t),g.fillLayer(n,o)},line:function(e){var t=a(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]);g.lineTo(t,n,o)},lstroke:function(e){var t=parseInt(e[0]),n=a(parseInt(e[1])),o=a(parseInt(e[2]));g.setChannelMask(n,t),g.strokeLayer(n,o)},move:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),i=parseInt(e[4]);if(t>0&&n>=0){var s=a(t),u=a(n);s.move(u,o,r,i)}},name:function(e){i.onname&&i.onname(e[0])},nest:function(e){var t=o(parseInt(e[0]));t.receive(e[1])},pipe:function(e){var t=parseInt(e[0]),n=e[1],a=e[2];if(i.onpipe){var o=S[t]=new Guacamole.InputStream(i,t);i.onpipe(o,n,a)}else i.sendAck(t,"Named pipes unsupported",256)},png:function(e){var t=parseInt(e[0]),n=a(parseInt(e[1])),o=parseInt(e[2]),r=parseInt(e[3]),i=e[4];g.setChannelMask(n,t),g.draw(n,o,r,"data:image/png;base64,"+i)},pop:function(e){var t=a(parseInt(e[0]));g.pop(t)},push:function(e){var t=a(parseInt(e[0]));g.push(t)},rect:function(e){var t=a(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),i=parseInt(e[4]);g.rect(t,n,o,r,i)},reset:function(e){var t=a(parseInt(e[0]));g.reset(t)},set:function(e){var t=a(parseInt(e[0])),n=e[1],o=e[2],r=G[n];r&&r(t,o)},shade:function(e){var t=parseInt(e[0]),n=parseInt(e[1]);if(t>=0){var o=a(t);o.shade(n)}},size:function(e){var t=parseInt(e[0]),n=a(t),o=parseInt(e[1]),r=parseInt(e[2]);g.resize(n,o,r)},start:function(e){var t=a(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]);g.moveTo(t,n,o)},sync:function(e){var t=parseInt(e[0]);g.flush(null),i.onsync&&i.onsync(t)},transfer:function(e){var t=a(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),i=parseInt(e[4]),s=parseInt(e[5]),u=a(parseInt(e[6])),l=parseInt(e[7]),c=parseInt(e[8]);3===s?g.put(t,n,o,r,i,u,l,c):5!==s&&g.transfer(t,n,o,r,i,u,l,c,Guacamole.Client.DefaultTransferFunction[s])},transform:function(e){var t=a(parseInt(e[0])),n=parseFloat(e[1]),o=parseFloat(e[2]),r=parseFloat(e[3]),i=parseFloat(e[4]),s=parseFloat(e[5]),u=parseFloat(e[6]);g.transform(t,n,o,r,i,s,u)},video:function(t){var n=parseInt(t[0]),o=a(parseInt(t[1])),r=t[2],s=parseFloat(t[3]),u=S[n]=new Guacamole.InputStream(i,n),l=new Guacamole.BlobReader(u,r);l.onend=function(){var e=new FileReader;e.onload=function(){for(var t="",n=new Uint8Array(e.result),a=0;a<n.byteLength;a++)t+=String.fromCharCode(n[a]);o.play(r,s,"data:"+r+";base64,"+window.btoa(t))},e.readAsArrayBuffer(l.getBlob())},e.sendMessage("ack",n,"OK",0)}};e.oninstruction=function(e,t){var n=T[e];n&&n(t)},this.disconnect=function(){f!=h&&f!=d&&(t(d),m&&window.clearInterval(m),e.sendMessage("disconnect"),e.disconnect(),t(h))},this.connect=function(n){t(u);try{e.connect(n)}catch(a){throw t(s),a}t(l)}},Guacamole.Client.DefaultTransferFunction={0:function(e,t){t.red=t.green=t.blue=0},15:function(e,t){t.red=t.green=t.blue=255},3:function(e,t){t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha},5:function(e,t){},12:function(e,t){t.red=255&~e.red,t.green=255&~e.green,t.blue=255&~e.blue,t.alpha=e.alpha},10:function(e,t){t.red=255&~t.red,t.green=255&~t.green,t.blue=255&~t.blue},1:function(e,t){t.red=e.red&t.red,t.green=e.green&t.green,t.blue=e.blue&t.blue},14:function(e,t){t.red=255&~(e.red&t.red),t.green=255&~(e.green&t.green),t.blue=255&~(e.blue&t.blue)},7:function(e,t){t.red=e.red|t.red,t.green=e.green|t.green,t.blue=e.blue|t.blue},8:function(e,t){t.red=255&~(e.red|t.red),t.green=255&~(e.green|t.green),t.blue=255&~(e.blue|t.blue)},6:function(e,t){t.red=e.red^t.red,t.green=e.green^t.green,t.blue=e.blue^t.blue},9:function(e,t){t.red=255&~(e.red^t.red),t.green=255&~(e.green^t.green),t.blue=255&~(e.blue^t.blue)},4:function(e,t){t.red=255&(~e.red&t.red),t.green=255&(~e.green&t.green),t.blue=255&(~e.blue&t.blue)},13:function(e,t){t.red=255&(~e.red|t.red),t.green=255&(~e.green|t.green),t.blue=255&(~e.blue|t.blue)},2:function(e,t){t.red=255&(e.red&~t.red),t.green=255&(e.green&~t.green),t.blue=255&(e.blue&~t.blue)},11:function(e,t){t.red=255&(e.red|~t.red),t.green=255&(e.green|~t.green),t.blue=255&(e.blue|~t.blue)}};var Guacamole=Guacamole||{};Guacamole.Display=function(){function e(){for(var e=0;e<f.length;){var t=f[e];if(!t.isReady())break;t.flush(),e++}f.splice(0,e)}function t(e,t){this.isReady=function(){for(var e=0;e<t.length;e++)if(t[e].blocked)return!1;return!0},this.flush=function(){for(var n=0;n<t.length;n++)t[n].execute();e&&e()}}function n(t,n){var a=this;this.blocked=n,this.unblock=function(){a.blocked&&(a.blocked=!1,e())},this.execute=function(){t&&t()}}function a(e,t){var a=new n(e,t);return h.push(a),a}var o=this,r=0,i=0,s=1,u=document.createElement("div");u.style.position="relative",u.style.width=r+"px",u.style.height=i+"px",u.style.transformOrigin=u.style.webkitTransformOrigin=u.style.MozTransformOrigin=u.style.OTransformOrigin=u.style.msTransformOrigin="0 0";var l=new Guacamole.Display.VisibleLayer(r,i),c=new Guacamole.Display.VisibleLayer(0,0);c.setChannelMask(Guacamole.Layer.SRC),u.appendChild(l.getElement()),u.appendChild(c.getElement());var d=document.createElement("div");d.style.position="relative",d.style.width=r*s+"px",d.style.height=i*s+"px",d.appendChild(u),this.cursorHotspotX=0,this.cursorHotspotY=0,this.cursorX=0,this.cursorY=0,this.onresize=null,this.oncursor=null;var h=[],f=[];this.getElement=function(){return d},this.getWidth=function(){return r},this.getHeight=function(){return i},this.getDefaultLayer=function(){return l},this.getCursorLayer=function(){return c},this.createLayer=function(){var e=new Guacamole.Display.VisibleLayer(r,i);return e.move(l,0,0,0),e},this.createBuffer=function(){var e=new Guacamole.Layer(0,0);return e.autosize=1,e},this.flush=function(n){f.push(new t(n,h)),h=[],e()},this.setCursor=function(e,t,n,r,i,s,u){a(function(){o.cursorHotspotX=e,o.cursorHotspotY=t,c.resize(s,u),c.copy(n,r,i,s,u,0,0),o.moveCursor(o.cursorX,o.cursorY),o.oncursor&&o.oncursor(c.getCanvas(),e,t)})},this.showCursor=function(e){var t=c.getElement(),n=t.parentNode;e===!1?n&&n.removeChild(t):n!==u&&u.appendChild(t)},this.moveCursor=function(e,t){c.translate(e-o.cursorHotspotX,t-o.cursorHotspotY),o.cursorX=e,o.cursorY=t},this.resize=function(e,t,n){a(function(){e.resize(t,n),e===l&&(r=t,i=n,u.style.width=r+"px",u.style.height=i+"px",d.style.width=r*s+"px",d.style.height=i*s+"px",o.onresize&&o.onresize(t,n))})},this.drawImage=function(e,t,n,o){a(function(){e.drawImage(t,n,o)})},this.draw=function(e,t,n,o){var r=a(function(){e.drawImage(t,n,i)},!0),i=new Image;i.onload=r.unblock,i.src=o},this.play=function(e,t,n,o){var r=document.createElement("video");r.type=t,r.src=o,r.addEventListener("play",function(){function t(){e.drawImage(0,0,r),r.ended||window.setTimeout(t,20)}t()},!1),a(r.play)},this.transfer=function(e,t,n,o,r,i,s,u,l){a(function(){i.transfer(e,t,n,o,r,s,u,l)})},this.put=function(e,t,n,o,r,i,s,u){a(function(){i.put(e,t,n,o,r,s,u)})},this.copy=function(e,t,n,o,r,i,s,u){a(function(){i.copy(e,t,n,o,r,s,u)})},this.moveTo=function(e,t,n){a(function(){e.moveTo(t,n)})},this.lineTo=function(e,t,n){a(function(){e.lineTo(t,n)})},this.arc=function(e,t,n,o,r,i,s){a(function(){e.arc(t,n,o,r,i,s)})},this.curveTo=function(e,t,n,o,r,i,s){a(function(){e.curveTo(t,n,o,r,i,s)})},this.close=function(e){a(function(){e.close()})},this.rect=function(e,t,n,o,r){a(function(){e.rect(t,n,o,r)})},this.clip=function(e){a(function(){e.clip()})},this.strokeColor=function(e,t,n,o,r,i,s,u){a(function(){e.strokeColor(t,n,o,r,i,s,u)})},this.fillColor=function(e,t,n,o,r){a(function(){e.fillColor(t,n,o,r)})},this.strokeLayer=function(e,t,n,o,r){a(function(){e.strokeLayer(t,n,o,r)})},this.fillLayer=function(e,t){a(function(){e.fillLayer(t)})},this.push=function(e){a(function(){e.push()})},this.pop=function(e){a(function(){e.pop()})},this.reset=function(e){a(function(){e.reset()})},this.setTransform=function(e,t,n,o,r,i,s){a(function(){e.setTransform(t,n,o,r,i,s)})},this.transform=function(e,t,n,o,r,i,s){a(function(){e.transform(t,n,o,r,i,s)})},this.setChannelMask=function(e,t){a(function(){e.setChannelMask(t)})},this.setMiterLimit=function(e,t){a(function(){e.setMiterLimit(t)})},this.scale=function(e){u.style.transform=u.style.WebkitTransform=u.style.MozTransform=u.style.OTransform=u.style.msTransform="scale("+e+","+e+")",s=e,d.style.width=r*s+"px",d.style.height=i*s+"px"},this.getScale=function(){return s},this.flatten=function(){function e(e){var t=[];for(var n in e.children)t.push(e.children[n]);return t.sort(function(e,t){var n=e.z-t.z;if(0!==n)return n;var a=e.getElement(),o=t.getElement(),r=o.compareDocumentPosition(a);return r&Node.DOCUMENT_POSITION_PRECEDING?-1:r&Node.DOCUMENT_POSITION_FOLLOWING?1:0}),t}function t(n,o,r){if(n.width>0&&n.height>0){var i=a.globalAlpha;a.globalAlpha*=n.alpha/255,a.drawImage(n.getCanvas(),o,r);for(var s=e(n),u=0;u<s.length;u++){var l=s[u];t(l,o+l.x,r+l.y)}a.globalAlpha=i}}var n=document.createElement("canvas");n.width=l.width,n.height=l.height;var a=n.getContext("2d");return t(l,0,0),n}},Guacamole.Display.VisibleLayer=function(e,t){Guacamole.Layer.apply(this,[e,t]);var n=this;this.__unique_id=Guacamole.Display.VisibleLayer.__next_id++,this.alpha=255,this.x=0,this.y=0,this.z=0,this.matrix=[1,0,0,1,0,0],this.parent=null,this.children={};var a=n.getCanvas();a.style.position="absolute",a.style.left="0px",a.style.top="0px";var o=document.createElement("div");o.appendChild(a),o.style.width=e+"px",o.style.height=t+"px",o.style.position="absolute",o.style.left="0px",o.style.top="0px",o.style.overflow="hidden";var r=this.resize;this.resize=function(e,t){o.style.width=e+"px",o.style.height=t+"px",r(e,t)},this.getElement=function(){return o};var i="translate(0px, 0px)",s="matrix(1, 0, 0, 1, 0, 0)";this.translate=function(e,t){n.x=e,n.y=t,i="translate("+e+"px,"+t+"px)",o.style.transform=o.style.WebkitTransform=o.style.MozTransform=o.style.OTransform=o.style.msTransform=i+" "+s},this.move=function(e,t,a,r){if(n.parent!==e){n.parent&&delete n.parent.children[n.__unique_id],n.parent=e,e.children[n.__unique_id]=n;var i=e.getElement();i.appendChild(o)}n.translate(t,a),n.z=r,o.style.zIndex=r},this.shade=function(e){n.alpha=e,o.style.opacity=e/255},this.dispose=function(){n.parent&&(delete n.parent.children[n.__unique_id],n.parent=null),o.parentNode&&o.parentNode.removeChild(o)},this.distort=function(e,t,a,r,u,l){n.matrix=[e,t,a,r,u,l],s="matrix("+e+","+t+","+a+","+r+","+u+","+l+")",o.style.transform=o.style.WebkitTransform=o.style.MozTransform=o.style.OTransform=o.style.msTransform=i+" "+s}},Guacamole.Display.VisibleLayer.__next_id=0;var Guacamole=Guacamole||{};Guacamole.InputStream=function(e,t){var n=this;this.index=t,this.onblob=null,this.onend=null,this.sendAck=function(t,a){e.sendAck(n.index,t,a)}};var Guacamole=Guacamole||{};Guacamole.IntegerPool=function(){var e=this,t=[];this.next_int=0,this.next=function(){return t.length>0?t.shift():e.next_int++},this.free=function(e){t.push(e)}};var Guacamole=Guacamole||{};Guacamole.Keyboard=function(e){function t(e,t){return e?e[t]||e[0]:null}function n(e,n,a){if(!e)return null;var r,i=e.indexOf("U+");if(i>=0){var s=e.substring(i+2);r=String.fromCharCode(parseInt(s,16))}else{if(1!==e.length)return t(w[e],n);r=e}a===!0?r=r.toUpperCase():a===!1&&(r=r.toLowerCase());var u=r.charCodeAt(0);return o(u)}function a(e){return 31>=e||e>=127&&159>=e}function o(e){return a(e)?65280|e:e>=0&&255>=e?e:e>=256&&1114111>=e?16777216|e:null}function r(e,n){return t(g[e],n)}function i(e,t){if(!t)return!1;var n=t.indexOf("U+");if(-1===n)return!0;var a=parseInt(t.substring(n+2),16);return e!==a?!0:e>=65&&90>=e||e>=48&&57>=e}function s(e){var t=Guacamole.Keyboard.ModifierState.fromKeyboardEvent(e);d.modifiers.alt&&t.alt===!1&&(d.release(65513),d.release(65514),d.release(65027)),d.modifiers.shift&&t.shift===!1&&(d.release(65505),d.release(65506)),d.modifiers.ctrl&&t.ctrl===!1&&(d.release(65507),d.release(65508)),d.modifiers.meta&&t.meta===!1&&(d.release(65511),d.release(65512)),d.modifiers.hyper&&t.hyper===!1&&(d.release(65515),d.release(65516)),d.modifiers=t}function u(){var e=c();if(!e)return!1;var t;do t=e,e=c();while(null!==e);return t.defaultPrevented}function l(e){d.modifiers.ctrl&&d.modifiers.alt&&(e>=65&&90>=e||e>=97&&122>=e||(255>=e||16777216===(4278190080&e))&&(d.release(65507),d.release(65508),d.release(65513),d.release(65514)))}function c(){var e=v[0];if(!e)return null;if(!(e instanceof f)){if(e instanceof p){var t=e.keysym;return t?(d.release(t),e.defaultPrevented=!0):d.reset(),v.shift()}return v.shift()}var t=null,n=[];if(e.reliable?(t=e.keysym,n=v.splice(0,1)):v[1]instanceof m?(t=v[1].keysym,n=v.splice(0,2)):v[1]&&(t=e.keysym,n=v.splice(0,1)),n.length>0){if(t){l(t);var a=!d.press(t);S[e.keyCode]=t,d.modifiers.meta&&65511!==t&&65512!==t&&d.release(t);for(var o=0;o<n.length;o++)n[o].defaultPrevented=a}return e}return null}var d=this;this.onkeydown=null,this.onkeyup=null;var h=function(){var e=this;this.timestamp=(new Date).getTime(),this.defaultPrevented=!1,this.keysym=null,this.reliable=!1,this.getAge=function(){return(new Date).getTime()-e.timestamp}},f=function(e,t,a,o){h.apply(this),this.keyCode=e,this.keyIdentifier=t,this.key=a,this.location=o,this.keysym=n(a,o)||r(e,o),this.keysym&&(this.reliable=!0),!this.keysym&&i(e,t)&&(this.keysym=n(t,o,d.modifiers.shift));var s=!(d.modifiers.ctrl||navigator&&navigator.platform&&navigator.platform.match(/^mac/i)),u=!d.modifiers.alt;(u&&d.modifiers.ctrl||s&&d.modifiers.alt||d.modifiers.meta||d.modifiers.hyper)&&(this.reliable=!0),S[e]=this.keysym};f.prototype=new h;var m=function(e){h.apply(this),this.charCode=e,this.keysym=o(e),this.reliable=!0};m.prototype=new h;var p=function(e,t,a,o){h.apply(this),this.keyCode=e,this.keyIdentifier=t,this.key=a,this.location=o,this.keysym=S[e]||r(e,o)||n(a,o),this.reliable=!0};p.prototype=new h;var v=[],g={8:[65288],9:[65289],13:[65293],16:[65505,65505,65506],17:[65507,65507,65508],18:[65513,65513,65027],19:[65299],20:[65509],27:[65307],32:[32],33:[65365],34:[65366],35:[65367],36:[65360],37:[65361],38:[65362],39:[65363],40:[65364],45:[65379],46:[65535],91:[65515],92:[65383],93:null,112:[65470],113:[65471],114:[65472],115:[65473],116:[65474],117:[65475],118:[65476],119:[65477],120:[65478],121:[65479],122:[65480],123:[65481],144:[65407],145:[65300],225:[65027]},w={Again:[65382],AllCandidates:[65341],Alphanumeric:[65328],Alt:[65513,65513,65027],Attn:[64782],AltGraph:[65027],ArrowDown:[65364],ArrowLeft:[65361],ArrowRight:[65363],ArrowUp:[65362],Backspace:[65288],CapsLock:[65509],Cancel:[65385],Clear:[65291],Convert:[65313],Copy:[64789],Crsel:[64796],CrSel:[64796],CodeInput:[65335],Compose:[65312],Control:[65507,65507,65508],ContextMenu:[65383],DeadGrave:[65104],DeadAcute:[65105],DeadCircumflex:[65106],DeadTilde:[65107],DeadMacron:[65108],DeadBreve:[65109],DeadAboveDot:[65110],DeadUmlaut:[65111],DeadAboveRing:[65112],DeadDoubleacute:[65113],DeadCaron:[65114],DeadCedilla:[65115],DeadOgonek:[65116],DeadIota:[65117],DeadVoicedSound:[65118],DeadSemivoicedSound:[65119],Delete:[65535],Down:[65364],End:[65367],Enter:[65293],EraseEof:[64774],Escape:[65307],Execute:[65378],Exsel:[64797],ExSel:[64797],F1:[65470],F2:[65471],F3:[65472],F4:[65473],F5:[65474],F6:[65475],F7:[65476],F8:[65477],F9:[65478],F10:[65479],F11:[65480],F12:[65481],F13:[65482],F14:[65483],F15:[65484],F16:[65485],F17:[65486],F18:[65487],F19:[65488],F20:[65489],F21:[65490],F22:[65491],F23:[65492],F24:[65493],Find:[65384],GroupFirst:[65036],GroupLast:[65038],GroupNext:[65032],GroupPrevious:[65034],FullWidth:null,HalfWidth:null,HangulMode:[65329],Hankaku:[65321],HanjaMode:[65332],Help:[65386],Hiragana:[65317],HiraganaKatakana:[65319],Home:[65360],Hyper:[65517,65517,65518],Insert:[65379],JapaneseHiragana:[65317],JapaneseKatakana:[65318],JapaneseRomaji:[65316],JunjaMode:[65336],KanaMode:[65325],KanjiMode:[65313],Katakana:[65318],Left:[65361],Meta:[65511,65511,65512],ModeChange:[65406],NumLock:[65407],PageDown:[65366],PageUp:[65365],Pause:[65299],Play:[64790],PreviousCandidate:[65342],PrintScreen:[64797],Redo:[65382],Right:[65363],RomanCharacters:null,Scroll:[65300],Select:[65376],Separator:[65452],Shift:[65505,65505,65506],SingleCandidate:[65340],Super:[65515,65515,65516],Tab:[65289],Up:[65362],Undo:[65381],Win:[65515],Zenkaku:[65320],ZenkakuHankaku:[65322]},y={65027:!0,65505:!0,65506:!0,65507:!0,65508:!0,65511:!0,65512:!0,65513:!0,65514:!0,65515:!0,65516:!0};this.modifiers=new Guacamole.Keyboard.ModifierState,this.pressed={};var b={},S={},k=null,I=null;this.press=function(e){if(null!==e){if(!d.pressed[e]&&(d.pressed[e]=!0,d.onkeydown)){var t=d.onkeydown(e);return b[e]=t,window.clearTimeout(k),window.clearInterval(I),y[e]||(k=window.setTimeout(function(){I=window.setInterval(function(){d.onkeyup(e),d.onkeydown(e)},50)},500)),t}return b[e]||!1}},this.release=function(e){d.pressed[e]&&(delete d.pressed[e],window.clearTimeout(k),window.clearInterval(I),null!==e&&d.onkeyup&&d.onkeyup(e))},this.reset=function(){for(var e in d.pressed)d.release(parseInt(e));v=[]};var G=function(e){return"location"in e?e.location:"keyLocation"in e?e.keyLocation:0};e.addEventListener("keydown",function(e){if(d.onkeydown){var t;if(window.event?t=window.event.keyCode:e.which&&(t=e.which),s(e),229!==t){var n=new f(t,e.keyIdentifier,e.key,G(e));v.push(n),u()&&e.preventDefault()}}},!0),e.addEventListener("keypress",function(e){if(d.onkeydown||d.onkeyup){var t;window.event?t=window.event.keyCode:e.which&&(t=e.which),
s(e);var n=new m(t);v.push(n),u()&&e.preventDefault()}},!0),e.addEventListener("keyup",function(e){if(d.onkeyup){e.preventDefault();var t;window.event?t=window.event.keyCode:e.which&&(t=e.which),s(e);var n=new p(t,e.keyIdentifier,e.key,G(e));v.push(n),u()}},!0)},Guacamole.Keyboard.ModifierState=function(){this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.hyper=!1},Guacamole.Keyboard.ModifierState.fromKeyboardEvent=function(e){var t=new Guacamole.Keyboard.ModifierState;return t.shift=e.shiftKey,t.ctrl=e.ctrlKey,t.alt=e.altKey,t.meta=e.metaKey,e.getModifierState&&(t.hyper=e.getModifierState("OS")||e.getModifierState("Super")||e.getModifierState("Hyper")||e.getModifierState("Win")),t};var Guacamole=Guacamole||{};Guacamole.Layer=function(e,t){function n(e,t){var n=null;if(0!==o.width&&0!==o.height){n=document.createElement("canvas"),n.width=o.width,n.height=o.height;var a=n.getContext("2d");a.drawImage(r,0,0,o.width,o.height,0,0,o.width,o.height)}var s=i.globalCompositeOperation;r.width=e,r.height=t,n&&i.drawImage(n,0,0,o.width,o.height,0,0,o.width,o.height),i.globalCompositeOperation=s,o.width=e,o.height=t,u=0,i.save()}function a(e,t,n,a){var r,i=n+e,s=a+t;r=i>o.width?i:o.width;var u;u=s>o.height?s:o.height,o.resize(r,u)}var o=this,r=document.createElement("canvas"),i=r.getContext("2d");i.save();var s=!0,u=0,l={1:"destination-in",2:"destination-out",4:"source-in",6:"source-atop",8:"source-out",9:"destination-atop",10:"xor",11:"destination-over",12:"copy",14:"source-over",15:"lighter"};this.autosize=!1,this.width=e,this.height=t,this.getCanvas=function(){return r},this.resize=function(e,t){e===o.width&&t===o.height||n(e,t)},this.drawImage=function(e,t,n){o.autosize&&a(e,t,n.width,n.height),i.drawImage(n,e,t)},this.transfer=function(e,t,n,r,s,u,l,c){var d=e.getCanvas();if(!(t>=d.width||n>=d.height)&&(t+r>d.width&&(r=d.width-t),n+s>d.height&&(s=d.height-n),0!==r&&0!==s)){o.autosize&&a(u,l,r,s);for(var h=e.getCanvas().getContext("2d").getImageData(t,n,r,s),f=i.getImageData(u,l,r,s),m=0;r*s*4>m;m+=4){var p=new Guacamole.Layer.Pixel(h.data[m],h.data[m+1],h.data[m+2],h.data[m+3]),v=new Guacamole.Layer.Pixel(f.data[m],f.data[m+1],f.data[m+2],f.data[m+3]);c(p,v),f.data[m]=v.red,f.data[m+1]=v.green,f.data[m+2]=v.blue,f.data[m+3]=v.alpha}i.putImageData(f,u,l)}},this.put=function(e,t,n,r,s,u,l){var c=e.getCanvas();if(!(t>=c.width||n>=c.height)&&(t+r>c.width&&(r=c.width-t),n+s>c.height&&(s=c.height-n),0!==r&&0!==s)){o.autosize&&a(u,l,r,s);var d=e.getCanvas().getContext("2d").getImageData(t,n,r,s);i.putImageData(d,u,l)}},this.copy=function(e,t,n,r,s,u,l){var c=e.getCanvas();t>=c.width||n>=c.height||(t+r>c.width&&(r=c.width-t),n+s>c.height&&(s=c.height-n),0!==r&&0!==s&&(o.autosize&&a(u,l,r,s),i.drawImage(c,t,n,r,s,u,l,r,s)))},this.moveTo=function(e,t){s&&(i.beginPath(),s=!1),o.autosize&&a(e,t,0,0),i.moveTo(e,t)},this.lineTo=function(e,t){s&&(i.beginPath(),s=!1),o.autosize&&a(e,t,0,0),i.lineTo(e,t)},this.arc=function(e,t,n,r,u,l){s&&(i.beginPath(),s=!1),o.autosize&&a(e,t,0,0),i.arc(e,t,n,r,u,l)},this.curveTo=function(e,t,n,r,u,l){s&&(i.beginPath(),s=!1),o.autosize&&a(u,l,0,0),i.bezierCurveTo(e,t,n,r,u,l)},this.close=function(){i.closePath(),s=!0},this.rect=function(e,t,n,r){s&&(i.beginPath(),s=!1),o.autosize&&a(e,t,n,r),i.rect(e,t,n,r)},this.clip=function(){i.clip(),s=!0},this.strokeColor=function(e,t,n,a,o,r,u){i.lineCap=e,i.lineJoin=t,i.lineWidth=n,i.strokeStyle="rgba("+a+","+o+","+r+","+u/255+")",i.stroke(),s=!0},this.fillColor=function(e,t,n,a){i.fillStyle="rgba("+e+","+t+","+n+","+a/255+")",i.fill(),s=!0},this.strokeLayer=function(e,t,n,a){i.lineCap=e,i.lineJoin=t,i.lineWidth=n,i.strokeStyle=i.createPattern(a.getCanvas(),"repeat"),i.stroke(),s=!0},this.fillLayer=function(e){i.fillStyle=i.createPattern(e.getCanvas(),"repeat"),i.fill(),s=!0},this.push=function(){i.save(),u++},this.pop=function(){u>0&&(i.restore(),u--)},this.reset=function(){for(;u>0;)i.restore(),u--;i.restore(),i.save(),i.beginPath(),s=!1},this.setTransform=function(e,t,n,a,o,r){i.setTransform(e,t,n,a,o,r)},this.transform=function(e,t,n,a,o,r){i.transform(e,t,n,a,o,r)},this.setChannelMask=function(e){i.globalCompositeOperation=l[e]},this.setMiterLimit=function(e){i.miterLimit=e},r.width=e,r.height=t,r.style.zIndex=-1},Guacamole.Layer.ROUT=2,Guacamole.Layer.ATOP=6,Guacamole.Layer.XOR=10,Guacamole.Layer.ROVER=11,Guacamole.Layer.OVER=14,Guacamole.Layer.PLUS=15,Guacamole.Layer.RIN=1,Guacamole.Layer.IN=4,Guacamole.Layer.OUT=8,Guacamole.Layer.RATOP=9,Guacamole.Layer.SRC=12,Guacamole.Layer.Pixel=function(e,t,n,a){this.red=e,this.green=t,this.blue=n,this.alpha=a};var Guacamole=Guacamole||{};Guacamole.Mouse=function(e){function t(e){e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function n(){r=o.touchMouseThreshold}function a(e){var n=e.deltaY||-e.wheelDeltaY||-e.wheelDelta;for(n?1===e.deltaMode?n=e.deltaY*o.PIXELS_PER_LINE:2===e.deltaMode&&(n=e.deltaY*o.PIXELS_PER_PAGE):n=e.detail*o.PIXELS_PER_LINE,i+=n;i<=-o.scrollThreshold;)o.onmousedown&&(o.currentState.up=!0,o.onmousedown(o.currentState)),o.onmouseup&&(o.currentState.up=!1,o.onmouseup(o.currentState)),i+=o.scrollThreshold;for(;i>=o.scrollThreshold;)o.onmousedown&&(o.currentState.down=!0,o.onmousedown(o.currentState)),o.onmouseup&&(o.currentState.down=!1,o.onmouseup(o.currentState)),i-=o.scrollThreshold;t(e)}var o=this;this.touchMouseThreshold=3,this.scrollThreshold=120,this.PIXELS_PER_LINE=40,this.PIXELS_PER_PAGE=640,this.currentState=new Guacamole.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.onmouseout=null;var r=0,i=0;e.addEventListener("contextmenu",function(e){t(e)},!1),e.addEventListener("mousemove",function(n){return t(n),r?void r--:(o.currentState.fromClientPosition(e,n.clientX,n.clientY),void(o.onmousemove&&o.onmousemove(o.currentState)))},!1),e.addEventListener("mousedown",function(e){if(t(e),!r){switch(e.button){case 0:o.currentState.left=!0;break;case 1:o.currentState.middle=!0;break;case 2:o.currentState.right=!0}o.onmousedown&&o.onmousedown(o.currentState)}},!1),e.addEventListener("mouseup",function(e){if(t(e),!r){switch(e.button){case 0:o.currentState.left=!1;break;case 1:o.currentState.middle=!1;break;case 2:o.currentState.right=!1}o.onmouseup&&o.onmouseup(o.currentState)}},!1),e.addEventListener("mouseout",function(n){n||(n=window.event);for(var a=n.relatedTarget||n.toElement;a;){if(a===e)return;a=a.parentNode}t(n),(o.currentState.left||o.currentState.middle||o.currentState.right)&&(o.currentState.left=!1,o.currentState.middle=!1,o.currentState.right=!1,o.onmouseup&&o.onmouseup(o.currentState)),o.onmouseout&&o.onmouseout()},!1),e.addEventListener("selectstart",function(e){t(e)},!1),e.addEventListener("touchmove",n,!1),e.addEventListener("touchstart",n,!1),e.addEventListener("touchend",n,!1),e.addEventListener("DOMMouseScroll",a,!1),e.addEventListener("mousewheel",a,!1),e.addEventListener("wheel",a,!1);var s=function(){var e=document.createElement("div");if(!("cursor"in e.style))return!1;try{e.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"}catch(t){return!1}return/\burl\([^()]*\)\s+0\s+0\b/.test(e.style.cursor||"")}();this.setCursor=function(t,n,a){if(s){var o=t.toDataURL("image/png");return e.style.cursor="url("+o+") "+n+" "+a+", auto",!0}return!1}},Guacamole.Mouse.State=function(e,t,n,a,o,r,i){var s=this;this.x=e,this.y=t,this.left=n,this.middle=a,this.right=o,this.up=r,this.down=i,this.fromClientPosition=function(e,t,n){s.x=t-e.offsetLeft,s.y=n-e.offsetTop;for(var a=e.offsetParent;a&&a!==document.body;)s.x-=a.offsetLeft-a.scrollLeft,s.y-=a.offsetTop-a.scrollTop,a=a.offsetParent;if(a){var o=document.body.scrollLeft||document.documentElement.scrollLeft,r=document.body.scrollTop||document.documentElement.scrollTop;s.x-=a.offsetLeft-o,s.y-=a.offsetTop-r}}},Guacamole.Mouse.Touchpad=function(e){var t=this;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=10*(window.devicePixelRatio||1),this.currentState=new Guacamole.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null;var n=0,a=0,o=0,r=0,i=0,s={1:"left",2:"right",3:"middle"},u=!1,l=null;e.addEventListener("touchend",function(e){if(e.preventDefault(),u&&0===e.touches.length){var a=(new Date).getTime(),o=s[n];t.currentState[o]&&(t.currentState[o]=!1,t.onmouseup&&t.onmouseup(t.currentState),l&&(window.clearTimeout(l),l=null)),a-r<=t.clickTimingThreshold&&i<t.clickMoveThreshold&&(t.currentState[o]=!0,t.onmousedown&&t.onmousedown(t.currentState),l=window.setTimeout(function(){t.currentState[o]=!1,t.onmouseup&&t.onmouseup(t.currentState),u=!1},t.clickTimingThreshold)),l||(u=!1)}},!1),e.addEventListener("touchstart",function(e){if(e.preventDefault(),n=Math.min(e.touches.length,3),l&&(window.clearTimeout(l),l=null),!u){u=!0;var t=e.touches[0];a=t.clientX,o=t.clientY,r=(new Date).getTime(),i=0}},!1),e.addEventListener("touchmove",function(s){s.preventDefault();var u=s.touches[0],l=u.clientX-a,c=u.clientY-o;if(i+=Math.abs(l)+Math.abs(c),1===n){var d=i/((new Date).getTime()-r),h=1+d;t.currentState.x+=l*h,t.currentState.y+=c*h,t.currentState.x<0?t.currentState.x=0:t.currentState.x>=e.offsetWidth&&(t.currentState.x=e.offsetWidth-1),t.currentState.y<0?t.currentState.y=0:t.currentState.y>=e.offsetHeight&&(t.currentState.y=e.offsetHeight-1),t.onmousemove&&t.onmousemove(t.currentState),a=u.clientX,o=u.clientY}else if(2===n&&Math.abs(c)>=t.scrollThreshold){var f;f=c>0?"down":"up",t.currentState[f]=!0,t.onmousedown&&t.onmousedown(t.currentState),t.currentState[f]=!1,t.onmouseup&&t.onmouseup(t.currentState),a=u.clientX,o=u.clientY}},!1)},Guacamole.Mouse.Touchscreen=function(e){function t(e){u.currentState[e]||(u.currentState[e]=!0,u.onmousedown&&u.onmousedown(u.currentState))}function n(e){u.currentState[e]&&(u.currentState[e]=!1,u.onmouseup&&u.onmouseup(u.currentState))}function a(e){t(e),n(e)}function o(t,n){u.currentState.fromClientPosition(e,t,n),u.onmousemove&&u.onmousemove(u.currentState)}function r(e){var t=e.touches[0]||e.changedTouches[0],n=t.clientX-c,a=t.clientY-d;return Math.sqrt(n*n+a*a)>=u.clickMoveThreshold}function i(e){var t=e.touches[0];l=!0,c=t.clientX,d=t.clientY}function s(){window.clearTimeout(h),window.clearTimeout(f),l=!1}var u=this,l=!1,c=null,d=null,h=null,f=null;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=16*(window.devicePixelRatio||1),this.longPressThreshold=500,this.currentState=new Guacamole.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,e.addEventListener("touchend",function(e){if(l){if(0!==e.touches.length||1!==e.changedTouches.length)return void s();if(window.clearTimeout(f),n("left"),!r(e)&&(e.preventDefault(),!u.currentState.left)){var a=e.changedTouches[0];o(a.clientX,a.clientY),t("left"),h=window.setTimeout(function(){n("left"),s()},u.clickTimingThreshold)}}},!1),e.addEventListener("touchstart",function(e){return 1!==e.touches.length?void s():(e.preventDefault(),i(e),window.clearTimeout(h),void(f=window.setTimeout(function(){var t=e.touches[0];o(t.clientX,t.clientY),a("right"),s()},u.longPressThreshold)))},!1),e.addEventListener("touchmove",function(e){if(l){if(r(e)&&window.clearTimeout(f),1!==e.touches.length)return void s();if(u.currentState.left){e.preventDefault();var t=e.touches[0];o(t.clientX,t.clientY)}}},!1)};var Guacamole=Guacamole||{};Guacamole.OnScreenKeyboard=function(e){var t=this,n={},a={},o=[],r=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},i=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(/([^ ]+)[ ]*/g,function(e,n){return n===t?"":e})},s=0,u=function(e,t,n,a){this.width=t,this.height=n,this.scale=function(o){e.style.width=t*o+"px",e.style.height=n*o+"px",a&&(e.style.lineHeight=n*o+"px",e.style.fontSize=o+"px")}},l=function(e){for(var t=0;t<e.length;t++){var a=e[t];if(!(a in n))return!1}return!0},c=function(e){var n=t.keys[e];if(!n)return null;for(var a=n.length-1;a>=0;a--){var o=n[a];if(l(o.requires))return o}return null},d=function(e,o){if(!t.disabled&&!a[e]){r(o,"guac-keyboard-pressed");var s=c(e);if(s.modifier){var u="guac-keyboard-modifier-"+v(s.modifier),l=n[s.modifier];l?(i(f,u),delete n[s.modifier],t.onkeyup&&t.onkeyup(l)):(r(f,u),n[s.modifier]=s.keysym,t.onkeydown&&t.onkeydown(s.keysym))}else t.onkeydown&&t.onkeydown(s.keysym);a[e]=!0}},h=function(e,n){if(!t.disabled&&a[e]){i(n,"guac-keyboard-pressed");var o=c(e);!o.modifier&&t.onkeyup&&t.onkeyup(o.keysym),a[e]=!1}},f=document.createElement("div");f.className="guac-keyboard",f.onselectstart=f.onmousemove=f.onmouseup=f.onmousedown=function(e){return s&&s--,e.stopPropagation(),!1},this.touchMouseThreshold=3,this.onkeydown=null,this.onkeyup=null,this.layout=new Guacamole.OnScreenKeyboard.Layout(e),this.getElement=function(){return f},this.resize=function(e){for(var n=Math.floor(10*e/t.layout.width)/10,a=0;a<o.length;a++){var r=o[a];r.scale(n)}};var m=function(e,t){if(t instanceof Array){for(var n=[],a=0;a<t.length;a++)n.push(new Guacamole.OnScreenKeyboard.Key(t[a],e));return n}return"number"==typeof t?[new Guacamole.OnScreenKeyboard.Key({name:e,keysym:t})]:"string"==typeof t?[new Guacamole.OnScreenKeyboard.Key({name:e,title:t})]:[new Guacamole.OnScreenKeyboard.Key(t,e)]},p=function(t){var n={};for(var a in e.keys)n[a]=m(a,t[a]);return n};this.keys=p(e.keys);var v=function(e){var t=e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^A-Za-z0-9]+/g,"-").toLowerCase();return t},g=function w(e,n,a){var i,l=document.createElement("div");if(a&&r(l,"guac-keyboard-"+v(a)),n instanceof Array)for(r(l,"guac-keyboard-group"),i=0;i<n.length;i++)w(l,n[i]);else if(n instanceof Object){r(l,"guac-keyboard-group");var c=Object.keys(n).sort();for(i=0;i<c.length;i++){var a=c[i];w(l,n[a],a)}}else if("number"==typeof n)r(l,"guac-keyboard-gap"),o.push(new u(l,n,n));else if("string"==typeof n){var f=n;1===f.length&&(f="0x"+f.charCodeAt(0).toString(16)),r(l,"guac-keyboard-key-container");var m=document.createElement("div");m.className="guac-keyboard-key guac-keyboard-key-"+v(f);var p=t.keys[n];if(p)for(i=0;i<p.length;i++){var g=p[i],y=document.createElement("div");y.className="guac-keyboard-cap",y.textContent=g.title;for(var b=0;b<g.requires.length;b++){var S=g.requires[b];r(y,"guac-keyboard-requires-"+v(S)),r(m,"guac-keyboard-uses-"+v(S))}m.appendChild(y)}l.appendChild(m),o.push(new u(l,t.layout.keyWidths[n]||1,1,!0));var k=function(e){e.preventDefault(),s=t.touchMouseThreshold,d(n,m)},I=function(e){e.preventDefault(),s=t.touchMouseThreshold,h(n,m)},G=function(e){e.preventDefault(),0===s&&d(n,m)},T=function(e){e.preventDefault(),0===s&&h(n,m)};m.addEventListener("touchstart",k,!0),m.addEventListener("touchend",I,!0),m.addEventListener("mousedown",G,!0),m.addEventListener("mouseup",T,!0),m.addEventListener("mouseout",T,!0)}e.appendChild(l)};g(f,e.layout)},Guacamole.OnScreenKeyboard.Layout=function(e){this.language=e.language,this.type=e.type,this.keys=e.keys,this.layout=e.layout,this.width=e.width,this.keyWidths=e.keyWidths||{}},Guacamole.OnScreenKeyboard.Key=function(e,t){this.name=t||e.name,this.title=e.title||this.name,this.keysym=e.keysym||function(e){if(!e||1!==e.length)return null;var t=e.charCodeAt(0);return t>=0&&255>=t?t:t>=256&&1114111>=t?16777216|t:null}(this.title),this.modifier=e.modifier,this.requires=e.requires||[]};var Guacamole=Guacamole||{};Guacamole.OutputStream=function(e,t){var n=this;this.index=t,this.onack=null,this.sendBlob=function(t){e.sendBlob(n.index,t)},this.sendEnd=function(){e.endStream(n.index)}};var Guacamole=Guacamole||{};Guacamole.Parser=function(){var e=this,t="",n=[],a=-1,o=0;this.receive=function(r){for(o>4096&&a>=o&&(t=t.substring(o),a-=o,o=0),t+=r;a<t.length;){if(a>=o){var i=t.substring(o,a),s=t.substring(a,a+1);if(n.push(i),";"==s){var u=n.shift();null!=e.oninstruction&&e.oninstruction(u,n),n.length=0}else if(","!=s)throw new Error("Illegal terminator.");o=a+1}var l=t.indexOf(".",o);if(-1==l){o=t.length;break}var c=parseInt(t.substring(a+1,l));if(isNaN(c))throw new Error("Non-numeric character in element length.");o=l+1,a=o+c}},this.oninstruction=null};var Guacamole=Guacamole||{};Guacamole.Status=function(e,t){var n=this;this.code=e,this.message=t,this.isError=function(){return n.code<0||n.code>255}},Guacamole.Status.Code={SUCCESS:0,UNSUPPORTED:256,SERVER_ERROR:512,SERVER_BUSY:513,UPSTREAM_TIMEOUT:514,UPSTREAM_ERROR:515,RESOURCE_NOT_FOUND:516,RESOURCE_CONFLICT:517,CLIENT_BAD_REQUEST:768,CLIENT_UNAUTHORIZED:769,CLIENT_FORBIDDEN:771,CLIENT_TIMEOUT:776,CLIENT_OVERRUN:781,CLIENT_BAD_TYPE:783,CLIENT_TOO_MANY:797};var Guacamole=Guacamole||{};Guacamole.StringReader=function(e){function t(e){for(var t="",n=new Uint8Array(e),a=0;a<n.length;a++){var i=n[a];0===o?127===(127|i)?t+=String.fromCharCode(i):223===(31|i)?(r=31&i,o=1):239===(15|i)?(r=15&i,o=2):247===(7|i)?(r=7&i,o=3):t+="�":191===(63|i)?(r=r<<6|63&i,o--,0===o&&(t+=String.fromCharCode(r))):(o=0,t+="�")}return t}var n=this,a=new Guacamole.ArrayBufferReader(e),o=0,r=0;a.ondata=function(e){var a=t(e);n.ontext&&n.ontext(a)},a.onend=function(){n.onend&&n.onend()},this.ontext=null,this.onend=null};var Guacamole=Guacamole||{};Guacamole.StringWriter=function(e){function t(e){if(s+e>=i.length){var t=new Uint8Array(2*(s+e));t.set(i),i=t}s+=e}function n(e){var a,o;if(127>=e)a=0,o=1;else if(2047>=e)a=192,o=2;else if(65535>=e)a=224,o=3;else{if(!(2097151>=e))return void n(65533);a=240,o=4}t(o);for(var r=s-1,u=1;o>u;u++)i[r--]=128|63&e,e>>=6;i[r]=a|e}function a(e){for(var t=0;t<e.length;t++){var a=e.charCodeAt(t);n(a)}if(s>0){var o=i.subarray(0,s);return s=0,o}}var o=this,r=new Guacamole.ArrayBufferWriter(e),i=new Uint8Array(8192),s=0;r.onack=function(e){o.onack&&o.onack(e)},this.sendText=function(e){r.sendData(a(e))},this.sendEnd=function(){r.sendEnd()},this.onack=null};var Guacamole=Guacamole||{};Guacamole.Tunnel=function(){this.connect=function(e){},this.disconnect=function(){},this.sendMessage=function(e){},this.state=Guacamole.Tunnel.State.CONNECTING,this.receiveTimeout=15e3,this.onerror=null,this.onstatechange=null,this.oninstruction=null},Guacamole.Tunnel.State={CONNECTING:0,OPEN:1,CLOSED:2},Guacamole.HTTPTunnel=function(e){function t(){window.clearTimeout(g),g=window.setTimeout(function(){n(new Guacamole.Status(Guacamole.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},u.receiveTimeout)}function n(e){u.state!==Guacamole.Tunnel.State.CLOSED&&(e.code!==Guacamole.Status.Code.SUCCESS&&u.onerror&&(u.state!==Guacamole.Tunnel.State.CONNECTING&&e.code===Guacamole.Status.Code.RESOURCE_NOT_FOUND||u.onerror(e)),u.state=Guacamole.Tunnel.State.CLOSED,p=!1,u.onstatechange&&u.onstatechange(u.state))}function a(){if(u.state===Guacamole.Tunnel.State.OPEN)if(v.length>0){p=!0;var e=new XMLHttpRequest;e.open("POST",d+s),e.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),e.onreadystatechange=function(){4===e.readyState&&(200!==e.status?o(e):a())},e.send(v),v=""}else p=!1}function o(e){var t=parseInt(e.getResponseHeader("Guacamole-Status-Code")),a=e.getResponseHeader("Guacamole-Error-Message");n(new Guacamole.Status(t,a))}function r(e){function n(){if(u.state!==Guacamole.Tunnel.State.OPEN)return void(null!==a&&clearInterval(a));if(!(e.readyState<2)){var l;try{l=e.status}catch(f){l=200}if(s||200!==l||(s=i()),3===e.readyState||4===e.readyState){if(t(),m===h&&(3!==e.readyState||a?4!==e.readyState||a||clearInterval(a):a=setInterval(n,30)),0===e.status)return void u.disconnect();if(200!==e.status)return void o(e);var v;try{v=e.responseText}catch(f){return}for(;c<v.length;){if(c>=d){var g=v.substring(d,c),w=v.substring(c,c+1);if(p.push(g),";"===w){var y=p.shift();u.oninstruction&&u.oninstruction(y,p),p.length=0}d=c+1}var b=v.indexOf(".",d);if(-1===b){d=v.length;break}var S=parseInt(v.substring(c+1,b));if(0===S){a||clearInterval(a),e.onreadystatechange=null,e.abort(),s&&r(s);break}d=b+1,c=d+S}}}}var a=null,s=null,l=0,c=-1,d=0,p=new Array;m===h?e.onreadystatechange=function(){3===e.readyState&&(l++,l>=2&&(m=f,e.onreadystatechange=n)),n()}:e.onreadystatechange=n,n()}function i(){var e=new XMLHttpRequest;return e.open("GET",c+s+":"+w++),e.send(null),e}var s,u=this,l=e+"?connect",c=e+"?read:",d=e+"?write:",h=1,f=0,m=h,p=!1,v="",g=null;this.sendMessage=function(){function e(e){var t=new String(e);return t.length+"."+t}if(u.state===Guacamole.Tunnel.State.OPEN&&0!==arguments.length){for(var t=e(arguments[0]),n=1;n<arguments.length;n++)t+=","+e(arguments[n]);t+=";",v+=t,p||a()}};var w=0;this.connect=function(e){t();var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(200!==n.status)return void o(n);t(),s=n.responseText,u.state=Guacamole.Tunnel.State.OPEN,u.onstatechange&&u.onstatechange(u.state),r(i())}},n.open("POST",l,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(e)},this.disconnect=function(){n(new Guacamole.Status(Guacamole.Status.Code.SUCCESS,"Manually closed."))}},Guacamole.HTTPTunnel.prototype=new Guacamole.Tunnel,Guacamole.WebSocketTunnel=function(e){function t(){a.receiveTimeout&&(window.clearTimeout(r),r=window.setTimeout(function(){n(new Guacamole.Status(Guacamole.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},a.receiveTimeout))}function n(e){a.state!==Guacamole.Tunnel.State.CLOSED&&(e.code!==Guacamole.Status.Code.SUCCESS&&a.onerror&&a.onerror(e),a.state=Guacamole.Tunnel.State.CLOSED,a.onstatechange&&a.onstatechange(a.state),o.close())}var a=this,o=null,r=null,i={"http:":"ws:","https:":"wss:"};if("ws:"!==e.substring(0,3)&&"wss:"!==e.substring(0,4)){var s=i[window.location.protocol];if("/"===e.substring(0,1))e=s+"//"+window.location.host+e;else{var u=window.location.pathname.lastIndexOf("/"),l=window.location.pathname.substring(0,u+1);e=s+"//"+window.location.host+l+e}}this.sendRawMessage=function(e){o.send(e)},this.sendMessage=function(e){function t(e){var t=new String(e);return t.length+"."+t}if(a.state===Guacamole.Tunnel.State.OPEN&&0!==arguments.length){for(var n=t(arguments[0]),r=1;r<arguments.length;r++)n+=","+t(arguments[r]);n+=";",o.send(n)}},this.connect=function(r){t(),o=new WebSocket(r?e+"?"+r:e,"guacamole"),o.onopen=function(e){t(),a.state=Guacamole.Tunnel.State.OPEN,a.onstatechange&&a.onstatechange(a.state)},o.onclose=function(e){n(new Guacamole.Status(parseInt(e.reason),e.reason))},o.onerror=function(e){n(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR,e.data))},o.onmessage=function(e){t();var o,r=e.data,i=0,s=[];do{var u=r.indexOf(".",i);if(-1!==u){var l=parseInt(r.substring(o+1,u));i=u+1,o=i+l}else n(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR,"Incomplete instruction."));var c=r.substring(i,o),d=r.substring(o,o+1);if(s.push(c),";"===d){var h=s.shift();a.oninstruction&&a.oninstruction(h,s),s.length=0}i=o+1}while(i<r.length)}},this.disconnect=function(){n(new Guacamole.Status(Guacamole.Status.Code.SUCCESS,"Manually closed."))}},Guacamole.WebSocketTunnel.prototype=new Guacamole.Tunnel,Guacamole.ChainedTunnel=function(e){function t(e){function r(){var n=o.shift();return n&&(e.onerror=null,e.oninstruction=null,e.onstatechange=null,t(n)),n}function i(){e.onstatechange=a.onstatechange,e.oninstruction=a.oninstruction,e.onerror=a.onerror}a.disconnect=e.disconnect,a.sendMessage=e.sendMessage,e.onstatechange=function(e){switch(e){case Guacamole.Tunnel.State.OPEN:i(),a.onstatechange&&a.onstatechange(e);break;case Guacamole.Tunnel.State.CLOSED:!r()&&a.onstatechange&&a.onstatechange(e)}},e.oninstruction=function(e,t){i(),a.oninstruction&&a.oninstruction(e,t)},e.onerror=function(e){!r()&&a.onerror&&a.onerror(e)},e.connect(n)}for(var n,a=this,o=[],r=0;r<arguments.length;r++)o.push(arguments[r]);this.connect=function(e){n=e;var r=o.shift();r?t(r):a.onerror&&a.onerror(Guacamole.Status.Code.SERVER_ERROR,"No tunnels to try.")}},Guacamole.ChainedTunnel.prototype=new Guacamole.Tunnel;var Guacamole=Guacamole||{};Guacamole.API_VERSION="0.9.5";var DEBUG_LOG=!1,serverAddress="127.0.0.1:6004",DEBUG_SERVER_SETTINGS=!1,DEBUG_VM_SETTINGS=!1,DEBUG_LOGIN=!1,DEBUG_LOADING=!1,tunnel=new Guacamole.WebSocketTunnel("ws://"+serverAddress+"/"),pingInterval,vmTableSelected,vmSettingsName,vmSettingsVisible=!1,vmList={},defaultVMSettings={name:"","vnc-address":"127.0.0.1","vnc-port":5900,"qmp-socket-type":"local","qmp-address":"","qmp-port":5800,"qemu-cmd":"",hypervisor:"qemu","qemu-snapshot-mode":"off","restore-shutdown":!1,"restore-periodic":!1,"restore-hours":0,"restore-minutes":0,"turns-enabled":!1,"turn-time":20,"votes-enabled":!1,"vote-time":60,"vote-cooldown-time":120,"agent-enabled":!1,"agent-socket-type":"local","agent-use-virtio":!1,"agent-address":"","agent-port":5700,"restore-heartbeat":!1,"heartbeat-timeout":0,"uploads-enabled":!1,"upload-cooldown-time":120,"upload-max-size":20971520,"upload-max-filename":100},vmStatus={STOPPED:0,STARTING:1,RUNNING:2,STOPPING:3},statusMessages=["Stopped","Starting","Running","Stopping"],vmAction={Stop:"0",SeshID:"1",MasterPwd:"2",GetSettings:"3",SetSettings:"4",QEMU:"5",StartController:"6",StopController:"7",RestoreVM:"8",RebootVM:"9",ResetVM:"10",RestartVM:"11"};tunnel.onstatechange=function(e){switch(e){case Guacamole.Tunnel.State.OPEN:debugLog("Connected to server");var t=getCookie("sessionID");t?tunnel.sendMessage("admin",1,t):displayPasswordInput();break;case Guacamole.Tunnel.State.CLOSED:debugLog("Disconnected from server"),displayLoading(),pingInterval&&(window.clearInterval(pingInterval),pingInterval=null),reconnect()}},tunnel.oninstruction=function(e,t){if("admin"==e){if(t.length>1){var n=parseInt(t[0]);if(!isNaN(n))switch(n){case 0:if(0==t[1]){$("#password-input").is(":visible")||displayPasswordInput();var a=createAlert("<strong>Invalid Password</strong>");$("#password-input").prepend(a),a.show("fast");var o=$("#master-pwd");o.val(""),o.prop("disabled",!1),$("#pwd-submit").prop("disabled",!1)}else 1==t[1]?(vmSettingsName=null,vmTableSelected=null,$("#vm-list").html(""),getConfig()):2==t[1]&&displaySettingsError("Invalid VM ID");break;case 1:parseSettings(t[1]),$("#server-settings").is(":visible")||displayServerSettings();break;case 2:qemuMonitorOutput("&#13;&#10;"+t[1]);break;case 3:if(vmList.hasOwnProperty(t[1])){var r=vmList[t[1]];r.status=t[2],r.active=r.status!=vmStatus.STOPPED,$("#vm-list > tr").each(function(){var e=$(this).children("td");return e.eq(0).html()==r.name?(e.eq(1).html(statusMessages[r.status]),!1):void 0}),vmTableSelected===r.name&&updateVMButtons(r)}}}}else"nop"==e&&tunnel.sendMessage("nop")},$(function(){$("div.btn-group").not("[data-no-dropdown]").find("ul.dropdown-menu li a").click(function(e){e.preventDefault();var t=$(this).parent();if(!t.hasClass("disabled")){var n=t.parent().parent(),a=n.find("button");a.html($(this).text()+' <span class="caret"></span>');var o=$(this).data("value");a.data("value",o),n.removeClass("open"),a.trigger("dropdown",o)}}),$("#start-vm-btn").click(function(){tunnel.sendMessage("admin",vmAction.StartController,vmTableSelected)}),$("#stop-vm-btn").click(function(){tunnel.sendMessage("admin",vmAction.StopController,vmTableSelected)}),$("#restart-vm-btn").click(function(){tunnel.sendMessage("admin",vmAction.RestartVM,vmTableSelected)}),$("#vm-action-dropdown ul.dropdown-menu li a").click(function(e){e.preventDefault(),tunnel.sendMessage("admin",vmAction[$(this).data("value")],vmTableSelected)}),$("#settings-vm-btn").click(function(){$("#vm-settings").is(":visible")?alert("Please close the current VM settings before editing this VM's settings."):showVMSettings(vmTableSelected)}),$("#new-vm-btn").click(function(){vmSettingsName||$("#vm-settings").is(":visible")?alert("Please close the current VM settings before adding a new VM."):showVMSettings(null)}),$("#vm-qemu-snapshot-mode").on("dropdown",function(){var e="hd"==$(this).data("value");$("#restore-shutdown-chkbox").prop("disabled",!e),$("#restore-periodic-chkbox").prop("disabled",!e),$("#restore-periodic-chkbox").trigger("change")}),$("#qemu-monitor-send").click(function(){sendQEMUCmd()}),$("#qemu-monitor-input").keypress(function(e){13===e.which&&sendQEMUCmd()}),$("#chng-pwd-chkbox").change(function(){var e=!$(this).prop("checked");$("#chng-pwd-box").prop("disabled",e),$("#chng-pwd-btn").prop("disabled",e)}),$("#chng-pwd-btn").click(function(){changePassword()}),$("#turns-enabled-chkbox").change(function(){$("#turn-time-box").prop("disabled",!$(this).prop("checked"))}),$("#votes-enabled-chkbox").change(function(){$("#vote-time-box, #vote-cooldown-time-box").prop("disabled",!$(this).prop("checked"))}),$("#agent-enabled-chkbox").change(function(){$("#agent-socket-type-dropdown, #agent-use-virtio-chkbox, #agent-address-box, #restore-heartbeat-chkbox, #uploads-enabled-chkbox").prop("disabled",!$(this).prop("checked")).trigger("disabled")}),$("#agent-socket-type-dropdown").on("dropdown",function(e,t){$("#agent-port").prop("disabled","tcp"!==t)}).on("disabled",function(){$("#agent-port").prop("disabled",$(this).prop("disabled")||"tcp"!==$(this).data("value"))}),$("#uploads-enabled-chkbox").change(function(){$("#upload-cooldown-time-box, #upload-max-size-box, #upload-max-filename-box").prop("disabled",!$(this).prop("checked"))}).on("disabled",function(){$("#upload-cooldown-time-box, #upload-max-size-box, #upload-max-filename-box").prop("disabled",$(this).prop("disabled")||!$(this).prop("checked"))}),$("#restore-periodic-chkbox").change(function(){var e=!$(this).prop("checked");$("#restore-hours-box").prop("disabled",e),$("#restore-minutes-box").prop("disabled",e)}),$("#vm-name").keydown(function(e){32===e.which&&e.preventDefault()}),$("#delete-vm-btn").click(function(){vmSettingsName&&window.confirm("Are you sure you want to delete this VM?")&&(tunnel.sendMessage("admin",4,'{"del-vm":"'+vmSettingsName+'"}'),hideVMSettings())}),$("#save-server-settings").click(function(){saveServerSettings()}),$("#save-vm-btn").click(function(){saveVMSettings()}),$("#pwd-submit").click(function(){submitPassword()}),$("#master-pwd").keypress(function(e){13===e.which&&submitPassword()}),$("#vm-x-btn").click(function(){window.confirm("Warning\nIf you changed any settings they will not be saved.\n\nContinue?")&&hideVMSettings()});var e='{"settings":{"chat-rate-count":4,"chat-rate-time":3,"chat-mute-time":30,"max-cons":5,"vm":[{"id":0,"auto-start":true,"status":3,"display-name":"Windows XP","name":"win-xp","vnc-address":"127.0.0.1","vnc-port":5900,"qmp-address":"","qmp-port":5800,"qemu-cmd":"qemu-system-x86_64 -hda /home/user/Documents/win-xp-vm/win-xp.img -usbdevice tablet","restore-shutdown":true,"turns-enabled":true,"turn-time":20,"votes-enabled":true,"vote-time":60,"vote-cooldown-time":0,"qmp-socket-type":"local","hypervisor":"qemu","qemu-snapshot-mode":"hd","agent-enabled":false,"agent-socket-type":"local","agent-use-virtio":false,"agent-address":"","agent-port":5700,"uploads-enabled":false,"upload-cooldown-time":120,"upload-max-size":20971520,"upload-max-filename":100}]}}';DEBUG_SERVER_SETTINGS?(parseSettings(e),displayServerSettings()):DEBUG_VM_SETTINGS?(parseSettings(e),displayServerSettings(),showVMSettings("win-xp")):DEBUG_LOGIN?displayPasswordInput():DEBUG_LOADING?displayLoading():connect()});